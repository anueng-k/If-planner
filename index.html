<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IF Healthy Planner</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-50 text-slate-900">

<div class="max-w-md mx-auto min-h-screen p-4 space-y-6">

<header class="p-6 bg-teal-600 text-white text-center rounded-2xl">
<h1 class="text-xl font-bold">IF Healthy Planner</h1>
</header>

<!-- STATUS -->
<div id="status-card" class="rounded-3xl p-8 text-center border-2">
<p id="phase-label" class="text-sm font-bold mb-2"></p>
<div id="timer-display" class="text-5xl font-black">00:00:00</div>
</div>

<!-- PLAN SELECT -->
<section>
<h2 class="font-bold text-slate-500 text-sm mb-2">Fasting Schedule</h2>
<div class="grid grid-cols-3 gap-2">
<button onclick="setPlan(12)" class="plan-btn p-3 border rounded-xl">12/12</button>
<button onclick="setPlan(14)" class="plan-btn p-3 border rounded-xl">14/10</button>
<button onclick="setPlan(16)" class="plan-btn p-3 border rounded-xl">16/8</button>
<button onclick="setPlan(18)" class="plan-btn p-3 border rounded-xl">18/6</button>
<button onclick="setPlan(20)" class="plan-btn p-3 border rounded-xl">20/4</button>
</div>
</section>

<!-- START TIME -->
<section>
<h2 class="font-bold text-slate-500 text-sm mb-2">Eating Starts At</h2>
<div class="flex gap-2">
<button onclick="setStartTime('12:00')" class="p-3 border rounded-xl">12:00</button>
<button onclick="setStartTime('12:30')" class="p-3 border rounded-xl">12:30</button>
<button onclick="setStartTime('13:00')" class="p-3 border rounded-xl">13:00</button>
<input type="time" onchange="setStartTime(this.value)" class="p-3 border rounded-xl">
</div>
</section>

<!-- PLAN BY DAY -->
<section>
<h2 class="font-bold text-slate-500 text-sm mb-2">Plan by Day</h2>
<div id="day-plans" class="space-y-2"></div>
</section>

</div>

<script>

let fastingHours = parseInt(localStorage.getItem('fH')) || 16;
let startStr = localStorage.getItem('sT') || '12:30';
let dayPlans = JSON.parse(localStorage.getItem("dayPlans")) || {};
const days = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];

function setPlan(h){
fastingHours = h;
localStorage.setItem('fH',h);
updateUI();
}

function setStartTime(t){
startStr = t;
localStorage.setItem('sT',t);
updateUI();
}

function setDayPlan(dayIndex,plan){
dayPlans[dayIndex] = parseInt(plan);
localStorage.setItem("dayPlans",JSON.stringify(dayPlans));
updateUI();
}

function getTodayPlan(){
const today = new Date().getDay();
return dayPlans[today] || fastingHours;
}

function renderDayPlans(){
const box = document.getElementById("day-plans");
box.innerHTML = "";

days.forEach((d,i)=>{
const value = dayPlans[i] || fastingHours;

box.innerHTML += `
<div class="flex justify-between items-center bg-white p-3 rounded-xl border">
<span>${d}</span>
<select onchange="setDayPlan(${i},this.value)" class="border rounded p-1">
<option value="12" ${value==12?"selected":""}>12/12</option>
<option value="14" ${value==14?"selected":""}>14/10</option>
<option value="16" ${value==16?"selected":""}>16/8</option>
<option value="18" ${value==18?"selected":""}>18/6</option>
<option value="20" ${value==20?"selected":""}>20/4</option>
</select>
</div>
`;
});
}

function updateUI(){
renderDayPlans();

const fasting = getTodayPlan();
const now = new Date();
const [h,m] = startStr.split(':');

let start = new Date();
start.setHours(h,m,0);

let eatingEnd = new Date(start.getTime() + (24 - fasting)*3600000);

let isEating = now>=start && now<eatingEnd;

const label = document.getElementById("phase-label");
const timer = document.getElementById("timer-display");

if(isEating){
label.innerText="ðŸ´ Eating Window";
timer.innerText=formatTime(eatingEnd-now);
}else{
label.innerText="ðŸ”¥ Fasting Period";
let target = now>eatingEnd ? new Date(start.getTime()+86400000) : start;
timer.innerText=formatTime(target-now);
}
}

function formatTime(ms){
let s=Math.floor(ms/1000);
let h=Math.floor(s/3600);
let m=Math.floor((s%3600)/60);
let sec=s%60;
return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
}

setInterval(updateUI,1000);
updateUI();

</script>

</body>
</html>